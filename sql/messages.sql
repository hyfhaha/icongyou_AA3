CREATE TABLE `message` (
  `msg_id` bigint NOT NULL AUTO_INCREMENT COMMENT '消息ID',
  `conversation_id` varchar(128) NOT NULL COMMENT '会话ID',
  `sender_id` bigint NOT NULL COMMENT '发送者',
  `receiver_id` bigint NOT NULL COMMENT '接收者',
  `content` text NOT NULL COMMENT '文本内容',
  `content_type` varchar(20) NOT NULL DEFAULT 'text' COMMENT '内容类型',
  `status` tinyint NOT NULL DEFAULT 1 COMMENT '1正常 2撤回 3删除',
  `timestamp_ms` bigint NOT NULL COMMENT '发送时间戳(ms)',
  `tenant_id` bigint NOT NULL DEFAULT 0 COMMENT '租户ID',
  `recall_by` bigint DEFAULT NULL COMMENT '撤回人',
  `recall_time` bigint DEFAULT NULL COMMENT '撤回时间戳(ms)',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`msg_id`),
  FULLTEXT KEY `ft_content` (`content`),
  KEY `idx_conv_receiver` (`conversation_id`,`receiver_id`,`status`),
  KEY `idx_conv_time` (`conversation_id`,`timestamp_ms`),
  KEY `idx_tenant_time` (`tenant_id`,`timestamp_ms`),
  KEY `idx_sender_time` (`sender_id`,`timestamp_ms`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='聊天消息';
